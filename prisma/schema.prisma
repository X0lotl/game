// general

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

// models

model Game {
  id   String @id @default(cuid())
  name String

  UserGame UserGame[]
  GameStep GameStep[]

  @@map(name: "games")
}

model GameStep {
  id    String @id @default(cuid())
  title String

  xp   Int?
  cost Int?

  gameId String
  game   Game   @relation(fields: [gameId], references: [id])

  childSteps GameStep[] @relation("ChildSteps")
  parentStep GameStep?  @relation("ChildSteps", fields: [parentId], references: [id])
  parentId   String?

  @@map(name: "game_steps")
}

model UserGame {
  id String @id @default(cuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])
  gameId String
  game   Game   @relation(fields: [gameId], references: [id])

  createdAt DateTime @default(now()) @map(name: "created_at")
  updatedAt DateTime @default(now()) @map(name: "updated_at")

  @@map(name: "user_games")
}

model User {
  id    String @id @default(cuid())
  name  String
  email String @unique

  xp      Int
  balance Int

  UserGame UserGame[]

  @@map(name: "users")
}
